<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  	<title>SNTP</title>
	<meta content="NO-CACHE" http-equiv="Cache-control">
	<meta content="NO-CACHE" http-equiv="PRAGMA">
	<meta content="-1" http-equiv="EXPIRES">
	<meta content="text/html; CHARSET=UTF-8" http-equiv="Content-Type">

	<link rel="stylesheet" href="/style/blueprint/screen.css" type="text/css" media="screen, projection" />
	<link rel="stylesheet" href="/style/blueprint/print.css" type="text/css" media="print" /> 
	<!--[if lt IE 8]>
	  <link rel="stylesheet" href="/style/blueprint/ie.css" type="text/css" media="screen, projection" />
	<![endif]-->
	<link href="/style/global_style.css" rel="stylesheet" type="text/css" />
	
	<link type="text/css" href="/style/jqueryui/jquery-ui-1.8.16.custom.css" rel="Stylesheet" />	
	<script type="text/javascript" src="/js/jquery.js"></script>
	<script type="text/javascript" src="/js/jquery-ui.js"></script>
	
	<script type="text/javascript" src="/global/global_view.js"></script>

	<script type="text/javascript" src="/js/ui.js"></script>
	<script language="javascript" type="text/javascript" src="/js/airtiespatterns.js"></script>
	<script type="text/javascript" src="/js/airlib.js"></script>
	<script type="text/javascript">
	
	var sntp_id="sntp-0";
	var __V_SNTP_ENABLE_CHECK;
	var __V_SNTP_PRIM_SERVER;
	var __V_SNTP_SECN_SERVER;
	var __V_SNTP_TERT_SERVER;
	var __V_SNTP_TIMEZONE;
	var __V_SNTP_DAYLIGHT;
	var __V_SNTP_POLL_INTERVAL;

    var tempQuery = new Array();
    tempQuery.RelatedObject = "__V_SNTP_POLL_INTERVAL";
    tempQuery.RelatedName = getML("__ML_sntp_poll_interval");
    tempQuery.PageValBehaviour = [RegexField , RegexField];
    tempQuery.RegexFormat="0>";
    tempQuery.RegexPattern = "^([1-9][0-9]*)$";
    tempQuery.PageValGroup = "ClickSave";
    tempQuery.ObjType = "TextBoxObj";
    myPageData.push(tempQuery);

    var tempQuery = new Array();
    tempQuery.RelatedObject = "__V_SNTP_PRIM_SERVER";
    tempQuery.RelatedName = __ML_sntp_prim_server;
    tempQuery.PageValBehaviour = [RegexField , RegexField];
    tempQuery.RegexFormat="sample.domain.com ; 192.168.2.1";
    tempQuery.RegexPattern = "(?=^.{1,254}$)(^(([a-zA-Z0-9_\\-]{1,63}\\.){2,})([a-zA-Z][a-zA-Z0-9_\\-]{0,63})$)|^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})(\\.)){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$"
    tempQuery.PageValGroup = "ClickSave";
    tempQuery.ObjType = "TextBoxObj";
    myPageData.push(tempQuery);

    var tempQuery = new Array();
    tempQuery.RelatedObject = "__V_SNTP_SECN_SERVER";
    tempQuery.RelatedName = __ML_sntp_secn_server;
    tempQuery.PageValBehaviour = [RegexField , RegexField];
    tempQuery.RegexFormat="sample.domain.com ; 192.168.2.1";
    tempQuery.RegexPattern = "(?=^.{1,254}$)(^(([a-zA-Z0-9_\\-]{1,63}\\.){2,})([a-zA-Z][a-zA-Z0-9_\\-]{0,63})$)|^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})(\\.)){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$"
    tempQuery.PageValGroup = "ClickSave";
    tempQuery.ObjType = "TextBoxObj";
    myPageData.push(tempQuery);

    var tempQuery = new Array();
    tempQuery.RelatedObject = "__V_SNTP_TERT_SERVER";
    tempQuery.RelatedName = __ML_sntp_tert_server;
    tempQuery.PageValBehaviour = [RegexField , RegexField];
    tempQuery.RegexFormat="sample.domain.com ; 192.168.2.1 ";
    tempQuery.RegexPattern = "(?=^.{1,254}$)(^(([a-zA-Z0-9_\\-]{1,63}\\.){2,})([a-zA-Z][a-zA-Z0-9_\\-]{0,63})$)|^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})(\\.)){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$"
    tempQuery.PageValGroup = "ClickSave";
    tempQuery.ObjType = "TextBoxObj";
    myPageData.push(tempQuery);

	var obj;
				
	function startQuery()
	{
		obj = new uiObject();

		obj.addQuery({module: "sntp", key: "number_of_servers"});
		obj.addGet({module: "sntp", key: "settings"});
		
		obj.query();
		
		obj.addField({table: "sntpObj", module: "sntp", field: "status"});
		obj.addField({table: "sntpObj", module: "sntp", field: "prim_server"});
		obj.addField({table: "sntpObj", module: "sntp", field: "secn_server"});
		obj.addField({table: "sntpObj", module: "sntp", field: "tert_server"});
		obj.addField({table: "sntpObj", module: "sntp", field: "timezone"});
		obj.addField({table: "sntpObj", module: "sntp", field: "daylight"});
		obj.addField({table: "sntpObj", module: "sntp", field: "poll_interval"});
		obj.addField({table: "sntpObj", module: "sntp", field: "number_of_servers"});
		obj.addFilter({table: "sntpObj", module: "sntp", field: "status", property: "inst", compareType: "equal", compareValue: sntp_id});
		if(obj.tables["sntpObj"][0])
		{
			if(obj.tables['sntpObj'][0]['sntp']['status'].value == 1)
			{
				$("#__V_SNTP_ENABLE_CHECK").attr('checked', true);
			}
			else
			{
				$("#__V_SNTP_ENABLE_CHECK").attr('checked', false);
			}
			
			__V_SNTP_PRIM_SERVER = obj.tables['sntpObj'][0]['sntp']['prim_server'].value;
			__V_SNTP_SECN_SERVER = obj.tables['sntpObj'][0]['sntp']['secn_server'].value;
			__V_SNTP_TERT_SERVER = obj.tables['sntpObj'][0]['sntp']['tert_server'].value;
			__V_SNTP_TIMEZONE = obj.tables['sntpObj'][0]['sntp']['timezone'].value;
			__V_SNTP_DAYLIGHT = obj.tables['sntpObj'][0]['sntp']['daylight'].value;
			__V_SNTP_POLL_INTERVAL = obj.tables['sntpObj'][0]['sntp']['poll_interval'].value;

			if(obj.tables['sntpObj'][0]['sntp']['daylight'].value == 1)
			{
				$("#__V_SNTP_DAYLIGHT").attr('checked', true);
			}
			else
			{
				$("#__V_SNTP_DAYLIGHT").attr('checked', false);
			}
		}
		checkBeforeShowPage();
		showPage();
	}
	
	$(document).ready(function()
	{
		startQuery();

		globalView.addRowClass();
		globalView.addButtonClass();
	});
	
	function checkBeforeShowPage()
	{
		if(document.getElementById("__V_SNTP_ENABLE_CHECK").checked==true)
		{
			document.getElementById("__V_SNTP_PRIM_SERVER").disabled=false;
			document.getElementById("__V_SNTP_SECN_SERVER").disabled=false;
			document.getElementById("__V_SNTP_TERT_SERVER").disabled=false;
			document.getElementById("__V_SNTP_POLL_INTERVAL").disabled=false;
			document.getElementById("__V_SNTP_TIMEZONE").disabled=false;
			document.getElementById("__V_SNTP_DAYLIGHT").disabled=false;
		}
		else
		{
			document.getElementById("__V_SNTP_PRIM_SERVER").disabled=true;
			document.getElementById("__V_SNTP_SECN_SERVER").disabled=true;
			document.getElementById("__V_SNTP_TERT_SERVER").disabled=true;
			document.getElementById("__V_SNTP_POLL_INTERVAL").disabled=true;
			document.getElementById("__V_SNTP_TIMEZONE").disabled=true;
			document.getElementById("__V_SNTP_DAYLIGHT").disabled=true;
		}
		
		var numberOfTimeServer = 3;
		var supportedTimeServer = (obj.tables['sntpObj'][0]['sntp']['number_of_servers'].value == "") ? numberOfTimeServer : obj.tables['sntpObj'][0]['sntp']['number_of_servers'].value;
		
		for(var i=numberOfTimeServer; i>supportedTimeServer; i--)
		{
			$("#timeServer_" + i).hide();
		}
	}
	
	function ClickSave()
	{
		disablePage();
		beginXML();
		addCommand("cfgmgr-0", "begin_transaction", sntp_id);
		
		if(document.getElementById("__V_SNTP_ENABLE_CHECK").checked==true)
		{
			addSet(sntp_id,"status","1");
		}
		else
		{
			addSet(sntp_id,"status","0");
		}
		
		
		if(getVar("__V_SNTP_PRIM_SERVER") == "")
			addSet(sntp_id,"prim_server", "europe.pool.ntp.org");
		else
			addSet(sntp_id,"prim_server", getVar("__V_SNTP_PRIM_SERVER"));
		
		if(getVar("__V_SNTP_SECN_SERVER") == "")
			addSet(sntp_id,"secn_server", "pool.ntp.org");
		else
			addSet(sntp_id,"secn_server", getVar("__V_SNTP_SECN_SERVER"));
	
		if(getVar("__V_SNTP_TERT_SERVER") == "")
			addSet(sntp_id,"tert_server", "time.windows.com");
		else
			addSet(sntp_id,"tert_server", getVar("__V_SNTP_TERT_SERVER"));
		if( !(getVar("__V_SNTP_POLL_INTERVAL") > 0) )
			addSet(sntp_id,"poll_interval", "1440");
		else
			addSet(sntp_id,"poll_interval", getVar("__V_SNTP_POLL_INTERVAL"));
		
		addSet(sntp_id,"timezone", getVar("__V_SNTP_TIMEZONE"));
		if(document.getElementById("__V_SNTP_DAYLIGHT").checked==true)
		{
			addSet(sntp_id,"daylight","1");
		}
		else
		{
			addSet(sntp_id,"daylight","0");
		}
		
		addCommand("cfgmgr-0", "commit", sntp_id);
		addCommand("cfgmgr-0", "save", "");
	
		addCommand("cfgmgr-0", "end_transaction", sntp_id);
		addCommand(sntp_id, "apply","");
		
		endXML();
		var fn = reloadPage;
		sendAJAX(fn);
	}
	
	function ClickCancel()
	{
		reloadPage();
	}
	function reloadPage()
	{
		window.location.href="/tools/sntp.html";
	}
	function ClickEnableCheckbox()
	{
		if(document.getElementById("__V_SNTP_ENABLE_CHECK").checked==true)
		{
			document.getElementById("__V_SNTP_PRIM_SERVER").disabled=false;
			document.getElementById("__V_SNTP_SECN_SERVER").disabled=false;
			document.getElementById("__V_SNTP_TERT_SERVER").disabled=false;
			document.getElementById("__V_SNTP_POLL_INTERVAL").disabled=false;
			document.getElementById("__V_SNTP_TIMEZONE").disabled=false;
			document.getElementById("__V_SNTP_DAYLIGHT").disabled=false;
		}
		else
		{
			document.getElementById("__V_SNTP_PRIM_SERVER").disabled=true;
			document.getElementById("__V_SNTP_SECN_SERVER").disabled=true;
			document.getElementById("__V_SNTP_TERT_SERVER").disabled=true;
			document.getElementById("__V_SNTP_POLL_INTERVAL").disabled=true;
			document.getElementById("__V_SNTP_TIMEZONE").disabled=true;
			document.getElementById("__V_SNTP_DAYLIGHT").disabled=true;
		}
	}
	
	</script>
</head>
	<body>
		<div id="waitDiv" class="center">
			<p>
				<script language="javascript">document.write(__ML_please_wait);</script>
			</p>
			<img src="/images/ajax-loader.gif"/>
		</div>
		
		<div id="contentDiv" style="display:none">
			<div class="textCenter title">
				<span id="__ML_sntp_header" ml="__ML_sntp_header"></span>
			</div>
			<div class="marginCenter globalHeaderInfoDiv">
				<span id="__ML_sntp_info" ml="__ML_sntp_info"></span>
			</div>
		
		<table class="marginCenter globalTable globalBorder">
			<thead>
			    <tr>
			      <th colspan="2" class="textCenter"><input checked="checked" id="__V_SNTP_ENABLE_CHECK" type="checkbox" onClick="ClickEnableCheckbox()" >
			      <span id="__ML_sntp_enable">Enable Time Server</span></th>
			    </tr>
			</thead>
		  <tbody>
		    <tr id="timeServer_1">
		      <td><span id="__ML_sntp_prim_server">Primary Time Server</span>:</td>
		      <td><input type="text" maxlength="32" size="20" id="__V_SNTP_PRIM_SERVER" value="europe.pool.ntp.org"></td>
		    </tr>
		    <tr id="timeServer_2">
		      <td><span id="__ML_sntp_secn_server">Secondary Time Server</span>:</td>
		      <td><input type="text" maxlength="32" size="20" id="__V_SNTP_SECN_SERVER" value="pool.ntp.org"></td>
		    </tr>
		    <tr id="timeServer_3">
		      <td><span id="__ML_sntp_tert_server">Tertiary Time Server</span>:</td>
		      <td><input type="text" maxlength="32" size="20" id="__V_SNTP_TERT_SERVER" value="time.windows.com"></td>
		    </tr>
		    <tr>
		      <td><span id="__ML_sntp_poll_interval">Update Interval</span>:</td>
		      <td><input type="text" maxlength="8" size="8" id="__V_SNTP_POLL_INTERVAL" value="1440"> <span id="__ML_sntp_minutes">Minutes</span></td>
		    </tr>
		    <tr>
		      <td><span id="__ML_sntp_timezone">Time Zone</span>:</td>
		      <td>
		      <select id="__V_SNTP_TIMEZONE">
		      	<option value="GMT-12:00">(GMT-12:00) International Date Line West</option>
				<option value="GMT-11:00">(GMT-11:00) Midway Island</option>
				<option value="GMT-10:00">(GMT-10:00) Hawaii</option>
				<option value="GMT-09:00">(GMT-09:00) Alaska</option>
				<option value="GMT-08:00">(GMT-08:00) Pacific Time (US, Canada), Tijuana</option>
				<option value="GMT-07:00">(GMT-07:00) Arizona; Mountain Time (US, Canada)</option>
				<option value="GMT-06:00">(GMT-06:00) Central America; Central Time (US, Canada)</option>
				<option value="GMT-05:00">(GMT-05:00) Eastern Time (US, Canada)</option>
				<option value="GMT-04:00">(GMT-04:00) Atlantic Time (Canada)</option>
				<option value="GMT-03:00">(GMT-03:00) Brasilia; Buenos Aires; Greenland</option>
				<option value="GMT-02:00">(GMT-02:00) Mid-Atlantic</option>
				<option value="GMT-01:00">(GMT-01:00) Cape Vade</option>
				<option value="GMT+00:00" selected="selected">(GMT) Greenwhich Mean Time: Dublin, Lisbon, London; Casablanca</option>
				<option value="GMT+01:00">(GMT+01:00) Amsterdam, Berlin, Rome, Stockholm, Vienna, Paris</option>
				<option value="GMT+02:00">(GMT+02:00) Athens, Istanbul, Cairo, Harare, Jerusalem</option>
				<option value="GMT+03:00">(GMT+03:00) Baghdad, Kuwait, Riyadh, Moscow</option>
				<option value="GMT+04:00">(GMT+04:00) Muscat</option>
				<option value="GMT+05:00">(GMT+05:00) Islamabad, Karachi</option>
				<option value="GMT+05:30">(GMT+05:30) Chennai, Kolkata, Mumbai, New Delhi</option>
				<option value="GMT+06:00">(GMT+06:00) Dhaka</option>
				<option value="GMT+07:00">(GMT+07:00) Bangkok, Hanoi, Jakartha</option>
				<option value="GMT+08:00">(GMT+08:00) Beijing, Hong Kong</option>
				<option value="GMT+09:00">(GMT+09:00) Tokyo, Seoul</option>
				<option value="GMT+10:00">(GMT+10:00) Brisbane, Sydney</option>
				<option value="GMT+11:00">(GMT+11:00) Magadan, Solomon Islands</option>
				<option value="GMT+12:00">(GMT+12:00) Auckland, Wellington, Fiji</option>     
		      </select>
		      </td>
		    </tr>
		    <tr>
		      <td><span id="__ML_sntp_daylight">Daylight Saving</span>:</td>
		      <td><input checked="checked" id="__V_SNTP_DAYLIGHT" type="checkbox"></td>
		    </tr>
		  </tbody>
		</table>
		
		<div class="footer">
			<input id="__ML_save"  value="Save" type="button" onClick="if(PageValidate('ClickSave')== true)ClickSave()">
			<input id="__ML_cancel" value="Cancel" type="button" onClick="ClickCancel()">
		</div>
		
		</div>
	</body>
</html>
